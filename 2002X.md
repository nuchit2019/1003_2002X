# 2002X Flowchart
```mermaid
 flowchart TD
    Start["‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Export"]
    
    Section1["SECTION 1: ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤"]
    Section2["SECTION 2: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GIS CODE"]
    Section3["SECTION 3: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (SUMINS)"]
    Section4["SECTION 4: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Temp Package (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô Mapping)"]
    Section5["SECTION 5: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Temp Package (‡∏°‡∏µ‡πÉ‡∏ô Blue Map)"]
    Section6["SECTION 6: ‡∏•‡∏ö & Insert ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Export"]
    Section7["SECTION 7: Merge ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Å‡∏£‡∏ì‡∏µ FixRedNCB"]
    Section8["SECTION 8: Update ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà NULL ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Set"]
    Section9{"SECTION 9: TMP_BRAND_GEN = 'ALL' ?"}
    Section9Yes["SECTION 9: Insert ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ"]
    Section9No["‡∏Ç‡πâ‡∏≤‡∏° SECTION 9"]
    Section10["SECTION 10: Update Ad-hoc / ‡∏õ‡∏µ 2023"]
    
    End["‚úÖ ‡∏à‡∏ö‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Export"]

    Start --> Section1
    Section1 --> Section2
    Section2 --> Section3
    Section3 --> Section4
    Section3 --> Section5
    Section4 --> Section6
    Section5 --> Section6
    Section6 --> Section7
    Section7 --> Section8
    Section8 --> Section9

    Section9 -- ‡πÉ‡∏ä‡πà --> Section9Yes
    Section9 -- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà --> Section9No

    Section9Yes --> Section10
    Section9No --> Section10
    Section10 --> End
``` 

**‡∏™‡∏£‡∏∏‡∏õ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á SQL Script Template Export File: `Template Export File  2002X`** 

‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Section ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô:

#

### üîÅ **[SECTION 1] ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° (DELETE Temp)**

- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô Temp Table:
  - `TMP_EXP_BLUE_GIS_CODE_EV`
  - `TMP_EXP_BLUE_SUMINS_EV`
- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡πÑ‡∏ü‡∏•‡πå `2002X(EV)` + ‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≤‡∏¢ (`pgSaleCode`) + ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (`createBy`)

#

### üß† **[SECTION 2] ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GIS CODE ‚Üí ‡∏•‡∏á Temp**

- INSERT ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `INS_BLUE_GIS_CODE` (‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ, ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠, ‡∏Å‡∏•‡∏∏‡πà‡∏°, spec ‡∏Ø‡∏•‡∏Ø)
- Join ‡∏Å‡∏±‡∏ö `INS_MB_FILE_HEADER` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≤‡∏¢
- ‡πÉ‡∏ä‡πâ `PM_BLUE_BOOK_DT` ‡∏à‡∏≤‡∏Å `INS_MAPG_PREMIUM` ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

#

### üí∞ **[SECTION 3] ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (SUMINS) ‚Üí ‡∏•‡∏á Temp**

- INSERT ‡∏à‡∏≤‡∏Å `INS_BLUE_SUMINS` ‚Üí Temp `TMP_EXP_BLUE_SUMINS_EV`
- ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö GIS ‡πÅ‡∏ï‡πà‡∏î‡∏∂‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏∏‡∏ô (Min/Cost/Max) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏µ‡πâ‡∏¢
- ‡πÉ‡∏ä‡πâ `PM_BLUE_BOOK_DT` ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô

#

### üì¶ **[SECTION 4] ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Temp Package (‡∏Å‡∏£‡∏ì‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Mapping)**

- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `TMP_EXP_PACKAGE_2001_2_EV`
- INSERT ‡∏à‡∏≤‡∏Å `INS_MAPG_PREMIUM`
  - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà **‡πÑ‡∏°‡πà‡∏°‡∏µ** ‡πÉ‡∏ô `INS_BLUE_MAP_BPSS2002`
  - ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô `INS_MAIN_CONTROL`
- ‡∏™‡∏£‡∏∏‡∏õ Min/Max/Avg ‡∏ó‡∏∏‡∏ô ‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏ñ

#

### üîÅ **[SECTION 5] ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Temp Package (‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ Mapping ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)**

- INSERT Package ‡∏ó‡∏µ‡πà‡∏°‡∏µ Mapping ‡πÉ‡∏ô `INS_BLUE_MAP_BPSS2002`
- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç join: Brand/Model/SubModel/Year/SumIns ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á

#

### üì§ **[SECTION 6] Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏•‡∏á INS_EXP_2002_XYZ**

- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô `INS_EXP_2002_XYZ` ‡∏ó‡∏µ‡πà `createBy` ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
- INSERT ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ:
  - Join `INS_MAPG_PREMIUM` + `TMP_EXP_PACKAGE_2001_2_EV`
  - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì field ‡πÄ‡∏ä‡πà‡∏ô:
    - Subclass
    - Pattern Rate
    - ‡∏ó‡∏∏‡∏ô Default
    - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ï‡πà‡∏≤‡∏á ‡πÜ
    - EV Battery
    - Add Equip
    - Remark ‡∏Ø‡∏•‡∏Ø

#

### üßÆ **[SECTION 7] MERGE ‚Üí ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Å‡∏£‡∏ì‡∏µ FixRedNCB**

- ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ flag `RE-CAL(FixRedNCB)`
- ‡∏à‡∏∞ update ‡∏Ñ‡πà‡∏≤ `EXP_VOL_TOTAL` ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö flag ‡∏Ç‡∏≠‡∏á R/C/D

#

### üîß **[SECTION 8] Update ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á NULL ‡∏´‡∏£‡∏∑‡∏≠ Default**

- ‡πÄ‡∏ä‡πà‡∏ô:
  - `EXP_FT = EXP_SUM_INS` ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
  - `EXP_VOL_TOTAL` = Net + Stamp + SvcTax
  - `EXP_BRAND_SALE`, `EXP_MODEL_SALE` ‡∏ñ‡πâ‡∏≤ NULL ‚Üí ‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á

#

### üöó **[SECTION 9] ‡∏Å‡∏£‡∏ì‡∏µ TMP_BRAND_GEN = 'ALL' ‚Üí Insert ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°**

- ‡πÉ‡∏ä‡πâ GIS + SUMINS ‡∏°‡∏≤‡πÄ‡∏ï‡∏¥‡∏° Brand/Model ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
- ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ: Sedan, Pickup, Van
- ‡∏™‡∏£‡πâ‡∏≤‡∏á IBS_PUID ‡πÉ‡∏´‡∏°‡πà

#

### üß© **[SECTION 10] UPDATE ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Ad-hoc / ‡∏õ‡∏µ 2023**

- ‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏µ 2023:
  - ‡πÄ‡∏ä‡πá‡∏Ñ Default ‡∏à‡∏≤‡∏Å `INS_BLUE_SUMINS_YEAR2023`
  - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Default ‚Üí flag `X` ‚Üí ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Default
  - Update ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏à‡∏≤‡∏Å GIS ‡∏õ‡∏µ 2023

#

## üîÑ Flow Summary (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)

1. ‡∏•‡πâ‡∏≤‡∏á Temp ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GIS + ‡∏ó‡∏∏‡∏ô
3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ä‡∏∏‡∏î Package ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á Export
4. Insert ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Export
5. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/Update ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏©
6. ‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö
7. Insert ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å TMP_BRAND_GEN = 'ALL'
8. ‡∏õ‡∏£‡∏±‡∏ö Ad-hoc ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏õ‡∏µ 2023 ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞

#

